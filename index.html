<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSI Model Simulation</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
<header>
    <h1>OSI Model Simulation</h1>
</header>

<main>
    <form id="simulation-form">
        <label for="input-data">Data to send:</label>
        <input type="text" id="input-data" required>
        <button type="submit">Simulate</button>
    </form>

    <section id="results" class="hidden">
        <h2>Simulation Results</h2>
        <ul>
            <li>
                <span class="result-label">Original data:</span>
                <span id="original-data"></span>
            </li>
            <li>
                <span class="result-label">Transmitted data:</span>
                <span id="transmitted-data"></span>
            </li>
            <li>
                <span class="result-label">Received data:</span>
                <span id="received-data"></span>
            </li>
        </ul>
    </section>
</main>
<script>
    document.getElementById('simulation-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const inputData = document.getElementById('input-data').value;

        // Create the data packet with appropriate headers, similar to a TCP segment
        const dataPacket = {
            source_port: 12345, // Example source port
            destination_port: 80, // Example destination port
            sequence_number: 0, // Example sequence number
            acknowledgment_number: 0, // Example acknowledgment number
            data: inputData // The application-level request
        };

        const response = await fetch('index.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ dataPacket: dataPacket }) // Send the data packet instead of raw inputData
        });

        if (response.ok) {
            const result = await response.json();
            document.getElementById('original-data').textContent = result.originalData;
            document.getElementById('transmitted-data').textContent = result.transmittedData;
            document.getElementById('received-data').textContent = result.receivedData;
            document.getElementById('results').classList.remove('hidden');
        } else {
            const errorText = await response.text();
            alert('An error occurred while processing the simulation. ' + errorText);
        }
    });
</script>
</body>
</html>
